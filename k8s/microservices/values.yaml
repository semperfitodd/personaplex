services:
  frontend:
    enabled: true
    namespace:
      name: frontend
      create: true
    image:
      repository: frontend
      tag: '20260126141322'
    replicas: 2
    containerPort: 80
    servicePort: 80
    healthCheck:
      path: /health
      initialDelaySeconds: 10
      periodSeconds: 10
    ingress:
      enabled: true
      subdomain: personaplex
      scheme: internet-facing
      targetType: ip
      backendProtocol: HTTP
      healthCheckPath: /health

  personaplex:
    enabled: true
    namespace:
      name: personaplex
      create: true
    serviceAccount:
      roleName: personaplex-secrets
    image:
      repository: personaplex
      tag: '20260126144105'
    replicas: 1
    containerPort: 8998
    servicePort: 8998
    awsSecrets:
      - secretName: "personaplex/hf-token"
        jmesPath:
          - path: "HF_TOKEN"
            objectAlias: "HF_TOKEN"
            key: "HF_TOKEN"
    healthCheck:
      path: /
      initialDelaySeconds: 120
      periodSeconds: 30
      timeoutSeconds: 10
      failureThreshold: 3
    resources:
      requests:
        cpu: 4000m
        memory: 16Gi
        nvidia.com/gpu: 1
      limits:
        cpu: 8000m
        memory: 32Gi
        nvidia.com/gpu: 1
    envFrom:
      - secretRef:
          name: personaplex-secrets
    volumes:
      - name: secrets-store
        csi:
          driver: secrets-store.csi.k8s.io
          readOnly: true
          volumeAttributes:
            secretProviderClass: personaplex-secrets
    volumeMounts:
      - name: secrets-store
        mountPath: /mnt/secrets-store
        readOnly: true
    nodeSelector:
      workload-type: gpu
      nvidia.com/gpu.present: "true"
    tolerations:
      - key: nvidia.com/gpu
        operator: Equal
        value: "true"
        effect: NoSchedule
    ingress:
      enabled: true
      subdomain: api
      scheme: internet-facing
      targetType: ip
      backendProtocol: HTTPS
      healthCheckPath: /
